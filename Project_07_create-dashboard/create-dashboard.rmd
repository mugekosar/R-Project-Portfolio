---
title: "ECON 8000: Final Project"
output: 
  flexdashboard::flex_dashboard:
    theme: spacelab
    source: embed
    smart: false
runtime: shiny
---

```{r include = FALSE}

# LOAD PACKAGES

library(DT)
library(ggmap)
library(shiny)
library(knitr)
library(pander)
library(leaflet)
library(viridis)
library(rsconnect)
library(tidyverse)
library(flexdashboard)



# READ IN DATA

url <- paste0("https://github.com/DS4PS/Data-",
              "Science-Class/blob/master/DATA",
              "/TempeTrafficAccidents.rds?raw=true")

dat <- readRDS(gzcon(url(url)))



# DATA PREPROCESSING I: INJURIES & FATALITIES

dat        <- na.omit(dat)                                       # Remove NA
dat$fatal  <- dat$Totalfatalities > 0                            # 1+ fatalities
dat$inj    <- dat$Totalinjuries > 0 & dat$Totalfatalities == 0   # 1+ injuries, 0 fatal
dat$nohurt <- dat$Totalfatalities + dat$Totalinjuries == 0       # Harmless

date.vec   <- strptime(dat$DateTime, format = "%m/%d/%y %H:%M")  # Datetime variables
dat$hour   <- format(date.vec, format = "%H") %>% as.numeric()
dat$month  <- format(date.vec, format = "%b")
dat$day    <- format(date.vec, format = "%a")
dat$day365 <- format(date.vec, format = "%j")
dat$week   <- format(date.vec, format = "%V")
dat$hour1 <- dat$hour


# DATA PREPROCESSING II: NAMED INTERVALS OF TIME

dat <- dat %>% 
  mutate(time.of.day = case_when(hour >= 6 & hour <= 9 ~ "Morning Commute", 
                                 hour >= 16 & hour <= 19 ~ "Evening Commute", 
                                 hour >= 14 & hour <= 15 ~ "School Pickup", 
                                 hour >= 9 & hour <= 13 ~ "Work", 
                                 hour >= 20 & hour <= 23 ~ "Night", 
                                 hour <= 5 & hour >= 0 ~ "Midnight to Dawn"))

dat$harm <- ifelse(test = dat$Totalinjuries > 0 | dat$Totalfatalities > 0, 
                   yes = "Harm", 
                   no = "No Harm")



# DATA PREPROCESSING III: PERMUTATIONS OF INEBRIATION

dat <- dat %>% 
  mutate(d1.substance = case_when(AlcoholUse_Drv1 == "Alcohol" & 
                                  DrugUse_Drv1 == "No Apparent Influence" ~ "Alcohol", 
                                  AlcoholUse_Drv1 == "No Apparent Influence" & 
                                  DrugUse_Drv1 == "Drugs" ~ "Drugs", 
                                  AlcoholUse_Drv1 == "Alcohol" & 
                                  DrugUse_Drv1 == "Drugs" ~ "Alcohol and Drugs", 
                                  AlcoholUse_Drv1 == "No Apparent Influence" & 
                                  DrugUse_Drv1 == "No Apparent Influence" ~ "No Apparent Influence"))

dat <- dat %>% 
  mutate(d2.substance = case_when(AlcoholUse_Drv2 == "Alcohol" & 
                                  DrugUse_Drv2 == "No Apparent Influence" ~ "Alcohol", 
                                  AlcoholUse_Drv2 == "No Apparent Influence" & 
                                  DrugUse_Drv2 == "Drugs" ~ "Drugs", 
                                  AlcoholUse_Drv2 == "Alcohol" & 
                                  DrugUse_Drv2 == "Drugs" ~ "Alcohol and Drugs", 
                                  AlcoholUse_Drv2 == "No Apparent Influence" & 
                                  DrugUse_Drv2 == "No Apparent Influence" ~ "No Apparent Influence"))



# DATA PREPROCESSING IV: AGE CATEGORIES

dat$age.cat <- case_when(dat$Age_Drv1 >= 0 & 
                         dat$Age_Drv1 <= 18 ~ "Youth", 
                         dat$Age_Drv1 >= 19 & 
                         dat$Age_Drv1 <= 25 ~ "Young Adult", 
                         dat$Age_Drv1 >= 26 & 
                         dat$Age_Drv1 <= 64 ~ "Adult", 
                         dat$Age_Drv1 >= 65 ~ "Senior")

```

Day&Time
=====================================  

Inputs {.sidebar}
-------------------------------------

```{r}

checkboxGroupInput("days", 
                   label = h3("Day of Week"), 
    choices = list("Monday"    = "Mon", 
                   "Tuesday"   = "Tue", 
                   "Wednesday" = "Wed", 
                   "Thursday"  = "Thu",
                   "Friday"    = "Fri",
                   "Saturday"  = "Sat",
                   "Sunday"    = "Sun" ),
    selected = c("Fri",
                 "Sat",
                 "Sun"))

sliderInput(inputId = "hour", 
            label = h3("Time of Day"), 
            min = 0, 
            max = 23, 
            value = c(6, 12))

```

Outputs
-------------------------------------

### Traffic Accidents By Day and Time

```{r}

# LEAFLET MAPPING

renderLeaflet({
  
  d2 <- dat %>%
    filter(day %in% input$days, 
           hour >= input$hour[1],
           hour <= input$hour[2])
  
  d2$col.vec <- ifelse(test = d2$nohurt, 
                       yes = "gray20", 
                       no = ifelse(test = d2$inj, 
                                   yes = "steelblue", 
                                   no = "darkorange") ) 
  
  point.size <- d2$Totalinjuries + d2$Totalfatalities

  crash.details <- paste0("Time: ", d2$DateTime, "<br>",
                          "Total Fatalities: ", d2$Totalfatalities, "<br>",
                          "Total Injuries: ", d2$Totalinjuries, "<br>",
                          "Collision type: ", d2$Collisionmanner)
  
  tempe <- leaflet( ) %>% 
    addProviderTiles("CartoDB.Positron")  %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  addCircles(tempe, 
             lng = d2$Longitude, 
             lat = d2$Latitude,
             fillColor = d2$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)

})

```   

Age,Gender&Method {data-orientation=rows}
=====================================  

Sidebar {.sidebar}
-------------------------------------
Driver Characteristics

```{r}

sliderInput(inputId = "d1age", 
            label = h4("Driver 1 Age"), 
            min = 15, 
            max = 100, 
            value = c(18,36) )

sliderInput(inputId = "d2age", 
            label = h4("Driver 2 Age"), 
            min = 15, 
            max = 100, 
            value = c(18,36) )

selectInput(inputId = "d1gender", 
            label = h4("Driver 1 Gender"), 
            choices = c("Male",
                        "Female", 
                        "Unknown"), 
            selected = "Male")

selectInput(inputId = "d2gender", 
            label = h4("Driver 2 Gender"), 
            choices = c("Male",
                        "Female", 
                        "Unknown"), 
            selected = "Male")

radioButtons(inputId = "d1pedcy", 
             label = h4("Driver 1 Transportation"),
             choices = c("Driver", 
                         "Pedalcyclist", 
                         "Pedestrian"), 
             selected = "Driver")

radioButtons(inputId = "d2pedcy", 
             label = h4("Driver 2 Transportation"),
             choices = c("Driver", 
                         "Pedalcyclist", 
                         "Pedestrian"), 
             selected = "Driver")

```

Row 
-------------------------------------

### Number of Crashes
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy )
  
  crashes <- count(d2)
  
  valueBox(crashes, 
           icon = "fa-pencil",
           color = ifelse(test = crashes > 50, 
                          yes = "danger", 
                          no = "primary") )
  
})

```

### Total Injuries
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)
  
  total.injuries <- sum(d2$Totalinjuries)
  
  valueBox(total.injuries, 
           icon = "fa-angry",
           color = ifelse(test = total.injuries > 30, 
                          yes = "danger", 
                          no = "primary" ))

  })

```

### Total Fatalities
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)

  total.fatalities <- sum(d2$Totalfatalities)
  
  valueBox(total.fatalities, 
           icon = "fa-briefcase-medical",
           color = ifelse(test = total.fatalities > 10, 
                          yes = "danger", 
                          no = "primary"))
  
})

```

### Rate of Harm
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)
  
  rate.of.harm <- round(length(which(d2$harm == "Harm")) / count(d2), 3)
  
  valueBox(rate.of.harm, 
           icon = "fa-pencil",
           color = ifelse(test = rate.of.harm > 0.5, 
                          yes = "danger", 
                          no = "primary"))
  
})

```

Outputs
-------------------------------------

### Traffic Accidents by Driver Characteristics

```{r}

renderLeaflet({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)
  
  d2$col.vec <- ifelse(test = d2$nohurt, 
                       yes = "gray20", 
                       no = ifelse(test = d2$inj, 
                                   yes = "steelblue", 
                                   no = "darkorange") )              
    
  point.size <- d2$Totalinjuries + d2$Totalfatalities

  crash.details <- paste0("Time: ", d2$DateTime, "<br>",
                          "Total Fatalities: ", d2$Totalfatalities, "<br>",
                          "Total Injuries: ", d2$Totalinjuries, "<br>",
                          "Collision type: ", d2$Collisionmanner)
  
  tempe <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron")  %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  
  addCircles(tempe, 
             lng = d2$Longitude, 
             lat = d2$Latitude,
             fillColor = d2$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)


})

```   

Comparison {data-orientation=rows}
=====================================  

Sidebar {.sidebar}
-------------------------------------
Driver Characteristics

```{r}

sliderInput(inputId = "driver.1.age", 
            label = h4("Driver 1 Age"), 
            min = 15, 
            max = 100, 
            value = c(18, 36))

sliderInput(inputId = "driver.2.age", 
            label = h4("Driver 2 Age"), 
            min = 15, 
            max = 100, 
            value = c(18, 36))

selectInput(inputId = "driver.1.gender", 
            label = h4("Driver 1 Gender"), 
            choices = c("Male",
                        "Female", 
                        "Unknown"), 
            selected = "Male")

selectInput(inputId = "driver.2.gender", 
            label = h4("Driver 2 Gender"), 
            choices = c("Male",
                        "Female",
                        "Unknown"), 
            selected = "Male")

radioButtons(inputId = "driver.1.pedcy", 
             label = h4("Driver 1 Transportation"),
             choices = c("Driver",
                         "Pedalcyclist",
                         "Pedestrian"), 
             selected = "Driver")

radioButtons(inputId = "driver.2.pedcy", 
             label = h4("Driver 2 Transportation"),
             choices = c("Driver",
                         "Pedalcyclist",
                         "Pedestrian"), 
             selected = "Driver")

```

Row 
-------------------------------------

### Number of Crashes
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1] & Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1] & Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy )
  
  crashes <- count(d2)
  
  valueBox(crashes, 
           icon = "fa-pencil",
           color = ifelse( crashes > 50, "danger", "primary") )
  
})

```

### Total Injuries
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1] & Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1] & Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)
  
  total.injuries <- sum(d2$Totalinjuries)
  
  valueBox(total.injuries, 
           icon = "fa-angry",
           color = ifelse(total.injuries > 30, "danger", "primary"))
  
})

```

### Total Fatalities
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)

  total.fatalities <- sum(d2$Totalfatalities)
  
  valueBox(total.fatalities, 
           icon = "fa-briefcase-medical",
           color = ifelse(test = total.fatalities > 10, 
                          yes = "danger", 
                          no = "primary"))
  
})

```

### Rate of Harm
  
```{r}

renderValueBox({
  
  d2 <- dat %>%
    filter(Age_Drv1 >= input$d1age[1],
           Age_Drv1 <= input$d1age[2], 
           Age_Drv2 >= input$d2age[1],
           Age_Drv2 <= input$d2age[2], 
           Gender_Drv1 %in% input$d1gender, 
           Gender_Drv2 %in% input$d2gender, 
           Unittype_One %in% input$d1pedcy, 
           Unittype_Two %in% input$d2pedcy)
  
  rate.of.harm <- round(length(which(d2$harm == "Harm")) / count(d2), 3)
  
  valueBox(rate.of.harm, 
           icon = "fa-pencil",
           color = ifelse(test = rate.of.harm > 0.5, 
                          yes = "danger", 
                          no = "primary"))
  
})

```

Column
-------------------------------------

### Driver 1

```{r}

renderLeaflet({
  
  d10 <- dat %>%
    filter(Age_Drv1 >= input$driver.1.age[1],
           Age_Drv1 <= input$driver.1.age[2], 
           Gender_Drv1 %in% input$driver.1.gender, 
           Unittype_One %in% input$driver.1.pedcy )
  
  d10$col.vec <- ifelse(test = d10$nohurt, 
                        yes = "gray20", 
                        no = ifelse(test = d10$inj, 
                                    yes = "steelblue", 
                                    no = "darkorange"))              
    
  point.size <- d10$Totalinjuries + d10$Totalfatalities

  crash.details <- paste0("Time: ", d10$DateTime, "<br>",
                          "Total Fatalities: ", d10$Totalfatalities, "<br>",
                          "Total Injuries: ", d10$Totalinjuries, "<br>",
                          "Collision type: ", d10$Collisionmanner)
  
  tempe <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron") %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  addCircles(tempe, 
             lng = d10$Longitude, 
             lat = d10$Latitude,
             fillColor = d10$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)


})
```   

### Driver 2

```{r}

renderLeaflet({
  
  d11 <- dat %>%
    filter(Age_Drv2 >= input$driver.2.age[1],
           Age_Drv2 <= input$driver.2.age[2], 
           Gender_Drv2 %in% input$driver.2.gender, 
           Unittype_Two %in% input$driver.2.pedcy)
  
  d11$col.vec <- ifelse(test = d11$nohurt, 
                        yes = "gray20", 
                        no = ifelse(test = d11$inj, 
                                    yes = "steelblue", 
                                    no = "darkorange"))
  
  point.size2 <- d11$Totalinjuries + d11$Totalfatalities

  crash.details2 <- paste0("Time: ", d11$DateTime, "<br>",
                           "Total Fatalities: ", d11$Totalfatalities, "<br>",
                           "Total Injuries: ", d11$Totalinjuries, "<br>",
                           "Collision type: ", d11$Collisionmanner)
  
  tempe2 <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron") %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  addCircles(tempe2, 
             lng = d11$Longitude, 
             lat = d11$Latitude,
             fillColor = d11$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size2),
             popup = crash.details2 )

})

```   

Injury&Collision
=====================================  

Inputs {.sidebar}
-------------------------------------

```{r}

selectInput(inputId = "Injuryseverity",                 
            label = h4("Injury Severity"),
            choices = as.character(unique(dat$Injuryseverity)),
            selected = "Possible Injury")                     

selectInput(inputId = "Collisionmanner", 
            label = h4("Type Of Collision"),  
            choices = as.character(unique(dat$Collisionmanner)),
            selected = "Rear End")



sliderInput(inputId = "hour1",                       
            label = h4("Time of Day"), 
            min = 0,                                
            max = 23,                               
            value = c(6, 12))                       

```

Outputs
-------------------------------------

### Injury Severity & Type of Collision by Time

```{r}

renderLeaflet({
  
  severity <- input$Injuryseverity
  collision <- input$Collisionmanner
  start.time <- input$hour1[1]
  end.time <- input$hour1[2]


  d5 <- dat %>%
    filter(Injuryseverity == severity,
           Collisionmanner == collision,
           hour1 >= start.time & hour1 <= end.time)
           

  d5$col.vec <- ifelse(test = d5$nohurt, 
                       yes = "gray20", 
                       no = ifelse(test = d5$inj, 
                                   yes = "steelblue", 
                                   no = "darkorange")) 
  
  point.size <- d5$Totalinjuries + d5$Totalfatalities

  crash.details <- paste0("Time: ", d5$DateTime, "<br>",
                          "Total Fatalities: ", d5$Totalfatalities, "<br>",
                          "Total Injuries: ", d5$Totalinjuries, "<br>",
                          "Collision type: ", d5$Collisionmanner)
  
  tempe <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron") %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  
  addCircles(tempe, 
             lng = d5$Longitude, 
             lat = d5$Latitude,
             fillColor = d5$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)

})

```   

Alcohol&Drug Use {data-orientation=rows}
=====================================  

Sidebar {.sidebar}
-------------------------------------
Alcohol & Drug Use-Driver 1 & 2
```{r}

checkboxGroupInput("AlcoholUse_Drv1", 
                   label = h3("Alcohol Use-Driver 1"), 
    choices = as.character(unique(dat$AlcoholUse_Drv1)),
    selected = "Alcohol")                 
                 
checkboxGroupInput("DrugUse_Drv1", 
                   label = h3("Drug Use-Driver 1"), 
    choices = as.character(unique(dat$DrugUse_Drv1)),
    selected = "No Apparent Influence") 


checkboxGroupInput("AlcoholUse_Drv2", 
                   label = h3("Alcohol Use-Driver 2"), 
    choices = as.character(unique(dat$AlcoholUse_Drv2)),
    selected = "Alcohol")                 
                 
checkboxGroupInput("DrugUse_Drv2", 
                   label = h3("Drug Use-Driver 2"), 
    choices = as.character(unique(dat$DrugUse_Drv2)),
    selected = "No Apparent Influence")   




```


Row 
-------------------------------------

### Number of Crashes

```{r}


renderValueBox({
  
  d6 <- dat %>%
    filter(AlcoholUse_Drv1 %in% input$AlcoholUse_Drv1, 
           DrugUse_Drv1 %in% input$DrugUse_Drv1,
           AlcoholUse_Drv2 %in% input$AlcoholUse_Drv2, 
           DrugUse_Drv2 %in% input$DrugUse_Drv2)
  
  crashes <- count(d6)
  
  valueBox(crashes, 
           icon = "fa-pencil",
           color = ifelse(test = crashes > 50, 
                          yes = "danger", 
                          no = "primary") )
})
  





```

### Total Injuries
  
```{r}

renderValueBox({
  
  d8 <- dat %>%
    filter(AlcoholUse_Drv1 %in% input$AlcoholUse_Drv1, 
           DrugUse_Drv1 %in% input$DrugUse_Drv1,
            AlcoholUse_Drv2 %in% input$AlcoholUse_Drv2, 
           DrugUse_Drv2 %in% input$DrugUse_Drv2)
  
  total.injuries <- sum(d8$Totalinjuries)
  
  valueBox(total.injuries, 
           icon = "fa-angry",
           color = ifelse(test = total.injuries > 30, 
                          yes = "danger", 
                          no = "primary" ))

  })

```

### Total Fatalities
  
```{r}

renderValueBox({
  
  d9 <- dat %>%
    filter(AlcoholUse_Drv1 %in% input$AlcoholUse_Drv1, 
           DrugUse_Drv1 %in% input$DrugUse_Drv1,
            AlcoholUse_Drv2 %in% input$AlcoholUse_Drv2, 
           DrugUse_Drv2 %in% input$DrugUse_Drv2)

  total.fatalities <- sum(d9$Totalfatalities)
  
  valueBox(total.fatalities, 
           icon = "fa-briefcase-medical",
           color = ifelse(test = total.fatalities > 10, 
                          yes = "danger", 
                          no = "primary"))
  
})

```

### Rate of Harm
  
```{r}

renderValueBox({
  
  d10 <- dat %>%
    filter(AlcoholUse_Drv1 %in% input$AlcoholUse_Drv1, 
           DrugUse_Drv1 %in% input$DrugUse_Drv1,
            AlcoholUse_Drv2 %in% input$AlcoholUse_Drv2, 
           DrugUse_Drv2 %in% input$DrugUse_Drv2)
  
  rate.of.harm <- round(length(which(d10$harm == "Harm")) / count(d10), 3)
  
  valueBox(rate.of.harm, 
           icon = "fa-pencil",
           color = ifelse(test = rate.of.harm > 0.5, 
                          yes = "danger", 
                          no = "primary"))
  
})

```


Column
-------------------------------------

### Driver 1

```{r}

renderLeaflet({
  
  d7 <- dat %>%
    filter(AlcoholUse_Drv1 %in% input$AlcoholUse_Drv1, 
           DrugUse_Drv1 %in% input$DrugUse_Drv1)
  
  d7$col.vec <- ifelse(test = d7$nohurt, 
                       yes = "gray20", 
                       no = ifelse(test = d7$inj, 
                                   yes = "steelblue", 
                                   no = "darkorange") )              
    
  point.size <- d7$Totalinjuries + d7$Totalfatalities

  crash.details <- paste0("Time: ", d7$DateTime, "<br>",
                          "Total Fatalities: ", d7$Totalfatalities, "<br>",
                          "Total Injuries: ", d7$Totalinjuries, "<br>",
                          "Collision type: ", d7$Collisionmanner)
  
  tempe <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron")  %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  
  addCircles(tempe, 
             lng = d7$Longitude, 
             lat = d7$Latitude,
             fillColor = d7$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)


})
```   


### Driver 2
```{r}

renderLeaflet({
  
  d11 <- dat %>%
    filter(AlcoholUse_Drv2 %in% input$AlcoholUse_Drv2, 
           DrugUse_Drv2 %in% input$DrugUse_Drv2)
  
  d11$col.vec <- ifelse(test = d11$nohurt, 
                       yes = "gray20", 
                       no = ifelse(test = d11$inj, 
                                   yes = "steelblue", 
                                   no = "darkorange") )              
    
  point.size <- d11$Totalinjuries + d11$Totalfatalities

  crash.details <- paste0("Time: ", d11$DateTime, "<br>",
                          "Total Fatalities: ", d11$Totalfatalities, "<br>",
                          "Total Injuries: ", d11$Totalinjuries, "<br>",
                          "Collision type: ", d11$Collisionmanner)
  
  tempe <- leaflet() %>% 
    addProviderTiles("CartoDB.Positron")  %>%
    setView(lng = -111.9278, 
            lat = 33.39951, 
            zoom = 13)
  
  
  addCircles(tempe, 
             lng = d11$Longitude, 
             lat = d11$Latitude,
             fillColor = d11$col.vec, 
             fillOpacity = 0.5, 
             stroke = FALSE, 
             radius = 50 * (1 + 0.33 * point.size),
             popup = crash.details)


})

```   


About
===================================== 

Row 
-------------------------------------

### About this Dashboard
<br>
This dashboard is the final project for ECON 8000: Coding in R Policy Analytics.

It was created using the [City of Temp Open Data Portal](https://data.tempe.gov/).

The foundation of this dashboard was created by Dr. Jesse Lecy.
<br>

>Tabs

* The first tab allows the user to explore traffic accidents in Tempe by time periods.
* The second tab allows the user to explore the prevalance and severity of different types of accidents by driver characteristics:
  + Age
  + Gender
  + Transportation (Driver, pedestrian, or cyclist).

* The third tab allows the user to compare the prevalance and severity of different types of accidents by driver characteristics for Driver 1 and Driver 2,
* The fourth tab allows the user to explore injury severity and collision types of traffic accidents by time.
* The fifth tab allows the user to compare the traffic accidents by alcohol and drug usage for Driver 1 and Driver 2.


### Dashboard Author

**Muge Kosar**, MA in Economics

* [Email Muge](mailto:mkosar1@student.gsu.edu).

* [Connect via Linkedin](https://www.linkedin.com/in/mugekosar/).

Special thanks to Dr. Jesse Lecy of Arizona State University for created the wireframe of this dashboard, etc.


Row
-------------------------------------

DATA DICTIONARY

```{r}

url.dd <- paste0("https://raw.githubusercontent.com",
                 "/DS4PS/cpp-526-fall-2019/master/l",
                 "abs/final-project/TempeTrafficAcc",
                 "identsDataDictionary.csv")

data.dictionary <- read.csv(url.dd, 
                            stringsAsFactors = FALSE)

data.dictionary$description <- stringi::stri_trans_general(data.dictionary$description,
                                                           "latin-ascii")

data.dictionary %>%
  select(column, description) %>%
  pander()

```

Data
=====================================  

```{r}

these.buttons <- c("copy", 
                   "csv", 
                   "pdf", 
                   "print")

renderDataTable({
  
  datatable(dat[1:100, ], 
            filter = "bottom", 
            rownames = FALSE, 
            fillContainer = TRUE, 
            style = "bootstrap",
            class = "table-condensed table-striped",
            extensions = "Buttons", 
            options = list(dom = "Bfrtip", 
                           buttons = these.buttons))

  })

```
